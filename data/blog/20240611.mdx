---
title: 'ğŸ”® ä¼˜åŒ–é’‰é’‰å‘Šè­¦ç±»å‹æ ¹æ® fundType æ¥åˆ¤æ–­'
date: 2024-04-12T17:34:56+0800
tags: ['golang', 'research']
draft: false
summary: è¿™æ®µä»£ç å¦‚ä½•å†™çš„æ›´åŠ ä¼˜é›…
---

è¿™æ®µä»£ç å¦‚ä½•å†™çš„æ›´åŠ ä¼˜é›…ï¼š
```go
// sendDingTalkAlertNoOrders å½“æ—¥æŸ¥è¯¢ä¸åˆ°è®¢å•æ—¶é’‰é’‰å‘Šè­¦
func (t *Worker) sendDingTalkAlertNoOrders(ctx context.Context, fundType string) {
	var content string
	if fundType == constant.WorkerArgFundTypeMonetary {
		content = fmt.Sprintf(
			"%s ä»Šå¤©æ²¡æœ‰äº§ç”Ÿä»»ä½•è´§å¸åŸºé‡‘è®¢å•ï¼Œè¯·åŠæ—¶å…³æ³¨",
			env.GetSquareBracketsEnv(), fundType,
		)
	} else {
		content = fmt.Sprintf(
			"%s ä»Šå¤©æ²¡æœ‰äº§ç”Ÿä»»ä½•éè´§å¸åŸºé‡‘è®¢å•ï¼Œè¯·åŠæ—¶å…³æ³¨",
			env.GetSquareBracketsEnv(), fundType,
		)
	}

	t.dingTalkRestyClient.DingTalkRobotSendMsg(ctx,
		viper.GetString("dependence.dingTalkFundTask.accessToken"),
		viper.GetString("dependence.dingTalkFundTask.secret"),
		dingtalkmapping.DingTalkSendMsgRequest{
			Content: content,
		},
	)
}
```

è¦ä½¿è¿™æ®µ Go ä»£ç æ›´åŠ ä¼˜é›…ï¼Œä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ä¼˜åŒ–ï¼š

1. **ç®€åŒ–æ¶ˆæ¯å†…å®¹æ„å»ºé€»è¾‘**ï¼šé€šè¿‡æå‰è®¾ç½®æ¶ˆæ¯æ¨¡æ¿ï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚
2. **ä½¿ç”¨å†…è”æ¡ä»¶è¡¨è¾¾å¼**ï¼šè¿™åœ¨ Go ä¸­ä¸ç›´æ¥æ”¯æŒï¼Œä½†å¯ä»¥é€šè¿‡å°å‡½æ•°æ¥å®ç°ç±»ä¼¼æ•ˆæœã€‚
3. **å°è£…é…ç½®è·å–é€»è¾‘**ï¼šç®€åŒ– `DingTalkRobotSendMsg` æ–¹æ³•è°ƒç”¨ä¸­çš„å‚æ•°è·å–ã€‚
4. **å¢å¼ºä»£ç å¯è¯»æ€§**ï¼šæ·»åŠ ä¸€äº›æ³¨é‡Šæ¥æè¿°å…³é”®æ­¥éª¤ï¼Œä½¿ä»£ç æ›´æ˜“ç†è§£ã€‚

è¿™æ˜¯ä¼˜åŒ–åçš„ä»£ç ç¤ºä¾‹ï¼š

```go
// sendDingTalkAlertNoOrders alerts via DingTalk when no orders are found for the day.
func (t *Worker) sendDingTalkAlertNoOrders(ctx context.Context, fundType string) {
    // Choose the appropriate message template based on the fund type.
    messageType := map[bool]string{true: "è´§å¸åŸºé‡‘", false: "éè´§å¸åŸºé‡‘"}[fundType == constant.WorkerArgFundTypeMonetary]
    content := fmt.Sprintf(
        "%s ä»Šå¤©æ²¡æœ‰äº§ç”Ÿä»»ä½•%sè®¢å•ï¼Œè¯·åŠæ—¶å…³æ³¨",
        env.GetSquareBracketsEnv(), messageType,
    )

    // Fetch DingTalk configuration from environment or config file.
    accessToken := viper.GetString("dependence.dingTalkFundTask.accessToken")
    secret := viper.GetString("dependence.dingTalkFundTask.secret")

    // Send message using DingTalk client.
    t.dingTalkRestyClient.DingTalkRobotSendMsg(ctx, accessToken, secret, dingtalkmapping.DingTalkSendMsgRequest{
        Content: content,
    })
}
```

è¿™ä¸ªé‡æ„ç‰ˆæœ¬åˆ©ç”¨äº† Go çš„æ˜ å°„æ¥é€‰æ‹©æ¶ˆæ¯ç±»å‹ï¼Œå‡å°‘äº†åŸæœ‰çš„ if-else æ¡ä»¶åˆ¤æ–­ï¼Œä½¿å‡½æ•°æ›´ä¸ºç²¾ç®€ã€‚åŒæ—¶ï¼Œå°†é…ç½®é¡¹ç›´æ¥åœ¨è°ƒç”¨æ—¶è·å–ï¼Œå‡å°‘äº†ä»£ç çš„å¤æ‚åº¦ï¼Œå¹¶ä½¿å‡½æ•°çš„è°ƒç”¨æ›´ä¸ºæ¸…æ™°ã€‚

å½“ç„¶å¯ä»¥ï¼Œè¿™æ˜¯å¸¦æœ‰ä¸­æ–‡æ³¨é‡Šçš„ä¼˜åŒ–åçš„ä»£ç ï¼š

```go
// sendDingTalkAlertNoOrders å½“æ—¥æ— è®¢å•æ—¶é€šè¿‡é’‰é’‰å‘é€è­¦å‘Šã€‚
func (t *Worker) sendDingTalkAlertNoOrders(ctx context.Context, fundType string) {
    // æ ¹æ®åŸºé‡‘ç±»å‹é€‰æ‹©é€‚å½“çš„æ¶ˆæ¯æ¨¡æ¿ã€‚
    messageType := map[bool]string{true: "è´§å¸åŸºé‡‘", false: "éè´§å¸åŸºé‡‘"}[fundType == constant.WorkerArgFundTypeMonetary]
    content := fmt.Sprintf(
        "%s ä»Šå¤©æ²¡æœ‰äº§ç”Ÿä»»ä½•%sè®¢å•ï¼Œè¯·åŠæ—¶å…³æ³¨",
        env.GetSquareBracketsEnv(), messageType,
    )

    // ä»ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­è·å–é’‰é’‰é…ç½®ã€‚
    accessToken := viper.GetString("dependence.dingTalkFundTask.accessToken")
    secret := viper.GetString("dependence.dingTalkFundTask.secret")

    // ä½¿ç”¨é’‰é’‰å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚
    t.dingTalkRestyClient.DingTalkRobotSendMsg(ctx, accessToken, secret, dingtalkmapping.DingTalkSendMsgRequest{
        Content: content,
    })
}
```

è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç ä½¿ç”¨äº†æ˜ å°„æ¥é€‰æ‹©æ¶ˆæ¯ç±»å‹ï¼Œé€šè¿‡é”®å€¼å¯¹çš„æ–¹å¼ç®€åŒ–äº†æ¡ä»¶é€»è¾‘ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ã€‚åŒæ—¶ï¼Œé…ç½®çš„è·å–ç›´æ¥åœ¨æ–¹æ³•è°ƒç”¨ä¸­è¿›è¡Œï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œæ˜“ç»´æŠ¤æ€§ã€‚
